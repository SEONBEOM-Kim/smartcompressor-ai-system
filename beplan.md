✦ 🚀 SignalCraft 백엔드 개선플랜

  1. 현재 아키텍처 분석

  이중 백엔드 구조
   - Node.js (Express): 포트 3000
     - 주요 기능: 인증, 실시간 통신(SSE), 정적 파일 제공
     - 주요 모듈: 인증, 알림, 모니터링, 관리자 기능

   - Python (Flask): 포트 8000
     - 주요 기능: AI/ML 분석, IoT 센서 데이터 처리
     - 주요 모듈: AI 분석, ESP32 통신, 대시보드, 센서 데이터 처리

  현재 문제점
   1. Flask 서버가 PM2로 관리되지 않음
   2. 단일 인스턴스로 인한 병목
   3. SQLite 동시성 제한
   4. 오류 추적 및 모니터링 부족
   5. 배포 과정에서 서비스 중단 발생

  2. 개선 우선순위 및 단계별 계획

  Phase 1: PM2 기반 Flask 서버 관리 (우선순위 1)
  목표: Flask 서버를 PM2로 관리하여 안정성 확보
  기간: 1-2주

   1. Gunicorn 설정 파일 작성
      - 기존 포트 8000 유지
      - 적절한 워커 수 계산
      - 로그 설정 통합

   2. PM2 설정 파일 업데이트
      - Node.js와 Python 서버 통합 관리
      - 로그 설정 통합
      - 자동 재시작 및 메모리 제한 설정

   3. 배포 스크립트 수정
      - 기존 pkill 방식 제거
      - PM2 기반 배포 방식으로 변경

  Phase 2: 데이터베이스 마이그레이션 (우선순위 2)
  목표: SQLite에서 PostgreSQL로 마이그레이션하여 동시성 문제 해결
  기간: 1-2주

   1. PostgreSQL 설정
      - AWS RDS 인스턴스 생성
      - 연결 풀 설정

   2. 애플리케이션 연결 변경
      - Node.js: pg 패키지 사용
      - Python Flask: SQLAlchemy 사용

   3. 마이그레이션 스크립트 작성
      - SQLite → PostgreSQL 데이터 마이그레이션
      - 테이블 스키마 검증

  Phase 3: Sentry 에러 트래킹 통합 (우선순위 3)
  목표: 실시간 에러 모니터링 및 성능 추적
  기간: 1주

   1. 의존성 설치
      - Node.js 및 Python에 Sentry SDK 설치

   2. 애플리케이션에 Sentry 초기화
      - 에러 캡처 및 성능 추적 설정

   3. 배포 시 Sentry 릴리즈 정보 통합

  Phase 4: 부하 테스트 및 모니터링 (우선순위 4)
  목표: 시스템 병목 분석 및 성능 측정
  기간: 1주

   1. k6 부하 테스트 스크립트 작성
      - AI 분석 요청 테스트
      - 인증 요청 테스트
      - 센서 데이터 요청 테스트

   2. 모니터링 대시보드 설정
      - PM2 내장 모니터링
      - 시스템 리소스 모니터링
      - DB 연결 수 모니터링

  Phase 5: Celery 비동기 처리 도입 (우선순위 5)
  조건: 부하 테스트에서 AI 분석이 병목으로 확인된 경우
  기간: 2주

   1. Celery 및 Redis 설정
      - Celery 앱 초기화
      - Redis 연결 설정

   2. 비동기 태스크 정의
      - AI 분석 태스크 정의
      - 진행 상태 추적

   3. API 엔드포인트 수정
      - 비동기 요청 처리
      - 결과 조회 엔드포인트 추가

  Phase 6: 보안 강화 및 보안 업데이트 (우선순위 6)
  목표: 시스템 보안 수준 향상
  기간: 2주

   1. JWT 토큰 보안 강화
      - 토큰 만료 시간 조정
      - Refresh 토큰 구현

   2. API Rate Limiting
      - 요청 제한 설정

   3. 입력 검증 강화
      - 모든 API 엔드포인트 검증 추가

  3. 주요 파일 변경 계획

  ecosystem.config.js 업데이트
   - Python Flask 서버 PM2 관리 추가
   - 로그 설정 통합
   - 클러스터 모드 설정 (Node.js)

  requirements.txt 업데이트
   - Gunicorn 추가
   - Celery 및 Redis (조건부)
   - Sentry SDK 추가

  app.py 변경
   - 애플리케이션 팩토리 패턴 유지
   - Production 설정 추가
   - Celery 통합 코드 (조건부)

  server/app.js 변경
   - Sentry 초기화 코드 추가
   - 모니터링 코드 업데이트

  4. 기대 효과

  성능 개선
   - AI 분석 응답 시간 개선: 평균 3초 → 2초 이하
   - 동시 사용자 처리 능력 향상: 15명 → 50명 이상
   - 서버 가용성 향상: 99.5% → 99.9% 이상

  안정성 향상
   - 자동 복구: PM2 기반 서버 자동 재시작
   - 에러 추적: Sentry 기반 실시간 에러 모니터링
   - 로그 관리: 통합 로그 시스템으로 문제 추적 용이

  확장성 확보
   - 가로 확장: 클러스터 모드로 인한 인스턴스 확장 가능
   - DB 성능: PostgreSQL 마이그레이션으로 동시성 처리 향상
   - 비동기 처리: Celery 도입으로 AI 분석 병목 해소

  5. 위험 요소 및 대응 전략


  ┌─────────────────────────────┬────────┬───────────────────────────────────┐
  │ 위험 요소                   │ 심각도 │ 대응 전략                         │
  ├─────────────────────────────┼────────┼───────────────────────────────────┤
  │ 데이터 마이그레이션 중 손실 │ 높음   │ 완전 백업 후 테스트 환경에서 검증 │
  │ 서비스 중단 시간 증가       │ 중간   │ 블루-그린 배포 방식 채택          │
  │ 성능 저하                   │ 중간   │ 점진적 도입 및 모니터링           │
  │ 보안 취약점                 │ 높음   │ 보안 감사 및 외부 검토            │
  └─────────────────────────────┴────────┴───────────────────────────────────┘


  6. 전체 일정

   - Phase 1: 1-2주 (Gunicorn + PM2 통합)
   - Phase 2: 3-4주 (PostgreSQL 마이그레이션)
   - Phase 3: 5주 (Sentry 에러 트래킹)
   - Phase 4: 6주 (부하 테스트 및 모니터링)
   - Phase 5: 7-8주 (Celery 비동기 처리 - 조건부)
   - Phase 6: 9-10주 (보안 강화)

  총 소요 기간: 10주 (Celery 미포함 시 6주)