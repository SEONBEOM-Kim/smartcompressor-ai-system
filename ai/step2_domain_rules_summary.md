# 🔧 2단계: 기본 규칙 생성 완료!

## 🎯 **도메인 지식 기반 규칙이 실제 AI에서 사용할 수 있도록 생성되었습니다**

---

## 📋 **생성된 규칙 카테고리 (5개)**

### **1. 기본 진단 규칙 (2개)**
- **정상 소리 감지 규칙**
  - 조건: RMS(0.1-0.4), ZCR(0.05-0.25), 안정성(≥0.7), 패턴규칙성(≥0.6), 주파수일관성(≥0.6)
  - 로직: 모든 조건이 정상 범위 내에 있으면 정상 소리로 판단
  - 신뢰도 가중치: 0.8

- **이상 소리 감지 규칙**
  - 조건: RMS(>0.4), ZCR(>0.3), 안정성(<0.5), 패턴규칙성(<0.4), 주파수일관성(<0.4)
  - 로직: 하나라도 이상 범위에 있으면 이상 소리로 판단
  - 신뢰도 가중치: 0.9

### **2. 고급 분석 규칙 (3개)**
- **안정성 분석 규칙**
  - 방법: RMS와 ZCR의 변동계수 계산
  - 공식: `stability = 1 / (1 + std(rms_windows) / mean(rms_windows))`
  - 임계값: 0.9(우수), 0.8(양호), 0.6(보통), 0.4(나쁨), 0.2(위험)

- **주파수 일관성 분석 규칙**
  - 방법: 스펙트럼 센트로이드의 안정성 측정
  - 공식: `consistency = 1 / (1 + std(spectral_centroids) / mean(spectral_centroids))`
  - 임계값: 0.8(우수), 0.7(양호), 0.5(보통), 0.3(나쁨), 0.1(위험)

- **패턴 규칙성 분석 규칙**
  - 방법: 자기상관 함수를 이용한 주기성 측정
  - 공식: `regularity = max(autocorr[1:]) / autocorr[0]`
  - 임계값: 0.8(우수), 0.7(양호), 0.5(보통), 0.3(나쁨), 0.1(위험)

### **3. 이상 유형 식별 규칙 (4개)**
- **베어링 마모 감지 규칙**
  - 조건: 스펙트럼 센트로이드(2000-8000Hz), RMS(>0.4), 패턴규칙성(<0.5), 안정성(<0.5)
  - 로직: 고주파, 높은 진폭, 불규칙한 패턴이면 베어링 마모
  - 신뢰도 가중치: 0.85

- **언밸런스 감지 규칙**
  - 조건: 스펙트럼 센트로이드(50-500Hz), RMS(>0.3), 패턴규칙성(>0.4), 안정성(<0.6)
  - 로직: 저주파, 높은 진폭, 주기적 진동이면 언밸런스
  - 신뢰도 가중치: 0.8

- **마찰 감지 규칙**
  - 조건: 스펙트럼 센트로이드(500-3000Hz), RMS(>0.25), 패턴규칙성(<0.6), 안정성(<0.6)
  - 로직: 중주파, 중간 진폭, 불규칙한 패턴이면 마찰
  - 신뢰도 가중치: 0.75

- **과부하 감지 규칙**
  - 조건: RMS(>0.5), 노이즈레벨(>0.5), 패턴규칙성(<0.3), 안정성(<0.3)
  - 로직: 높은 진폭, 높은 노이즈, 불규칙한 패턴이면 과부하
  - 신뢰도 가중치: 0.9

### **4. 심각도 평가 규칙 (3개)**
- **경미한 이상 평가 규칙**
  - 조건: 안정성(0.6-0.8), 패턴규칙성(0.5-0.7), 주파수일관성(0.5-0.7), 노이즈레벨(0.2-0.4)
  - 심각도 점수: 2점
  - 조치: 모니터링 강화, 정기 점검 유지
  - 응답 시간: 1-2주 내

- **중간 정도 이상 평가 규칙**
  - 조건: 안정성(0.4-0.6), 패턴규칙성(0.3-0.5), 주파수일관성(0.3-0.5), 노이즈레벨(0.4-0.6)
  - 심각도 점수: 5점
  - 조치: 점검 계획 수립, 모니터링 강화
  - 응답 시간: 3-5일 내

- **심각한 이상 평가 규칙**
  - 조건: 안정성(<0.4), 패턴규칙성(<0.3), 주파수일관성(<0.3), 노이즈레벨(>0.6)
  - 심각도 점수: 8점
  - 조치: 즉시 점검 필요, 운전 중단 고려
  - 응답 시간: 24시간 내

### **5. 엔지니어 휴리스틱 규칙 (5개)**
- **안정성 검사 휴리스틱**
  - 방법: RMS와 ZCR의 변동계수 계산
  - 임계값: 0.2
  - 엔지니어 규칙: 변동계수가 0.2 미만이면 정상, 이상이면 이상

- **주파수 일관성 검사 휴리스틱**
  - 방법: 스펙트럼 센트로이드의 안정성 측정
  - 임계값: 0.3
  - 엔지니어 규칙: 주파수 분포가 일정하면 정상, 변화가 크면 이상

- **패턴 규칙성 검사 휴리스틱**
  - 방법: 자기상관 함수를 이용한 주기성 측정
  - 임계값: 0.7
  - 엔지니어 규칙: 주기성이 높으면 정상, 낮으면 이상

- **하모닉스 분석 휴리스틱**
  - 방법: 기본 주파수의 하모닉스 존재 여부 확인
  - 임계값: 0.5
  - 엔지니어 규칙: 하모닉스가 정상적이면 정상, 비정상적이면 이상

- **노이즈 레벨 검사 휴리스틱**
  - 방법: 백그라운드 노이즈 레벨 측정
  - 임계값: 0.1
  - 엔지니어 규칙: 노이즈 레벨이 낮으면 정상, 높으면 이상

---

## 🔧 **규칙 엔진 구조**

### **실행 순서**
1. **기본 진단** (가중치: 0.3)
2. **고급 분석** (가중치: 0.25)
3. **이상 유형 식별** (가중치: 0.25)
4. **심각도 평가** (가중치: 0.15)
5. **엔지니어 휴리스틱** (가중치: 0.05)

### **신뢰도 계산**
- **방법**: 가중 평균
- **총 가중치**: 1.0
- **최종 신뢰도**: 각 규칙의 신뢰도 × 가중치의 합

---

## 📊 **생성된 규칙 통계**

### **규칙 수**
- **총 규칙 수**: 17개
- **기본 진단**: 2개
- **고급 분석**: 3개
- **이상 유형 식별**: 4개
- **심각도 평가**: 3개
- **엔지니어 휴리스틱**: 5개

### **규칙 카테고리**
- **진단 규칙**: 6개 (기본 2개 + 고급 3개 + 휴리스틱 1개)
- **식별 규칙**: 4개 (이상 유형 식별)
- **평가 규칙**: 3개 (심각도 평가)
- **분석 규칙**: 4개 (휴리스틱 4개)

---

## 🎯 **실제 AI에서 사용 가능한 형태**

### **규칙 실행 코드 예시**
```python
def execute_domain_rules(audio_data, features):
    # 1. 기본 진단
    basic_result = execute_basic_diagnostic(features)
    
    # 2. 고급 분석
    advanced_result = execute_advanced_analysis(features)
    
    # 3. 이상 유형 식별
    anomaly_result = execute_anomaly_identification(features)
    
    # 4. 심각도 평가
    severity_result = execute_severity_assessment(features)
    
    # 5. 엔지니어 휴리스틱
    heuristic_result = execute_expert_heuristics(features)
    
    # 6. 최종 결과 통합
    final_result = integrate_results([
        basic_result, advanced_result, anomaly_result, 
        severity_result, heuristic_result
    ])
    
    return final_result
```

### **규칙 저장 형태**
- **파일 형식**: JSON
- **저장 위치**: `data/generated_domain_rules.json`
- **버전**: 1.0.0
- **생성 시간**: 현재 시간

---

## 🎉 **2단계 완료 결과**

### **생성된 규칙의 특징**
- ✅ **실행 가능**: 실제 AI에서 바로 사용 가능한 형태
- ✅ **수치화**: 모든 조건이 구체적인 수치로 정의됨
- ✅ **가중치**: 각 규칙의 중요도가 가중치로 표현됨
- ✅ **통합**: 여러 규칙의 결과를 통합하는 방법 제공
- ✅ **확장성**: 새로운 규칙을 쉽게 추가할 수 있는 구조

### **다음 단계 준비**
- ✅ 도메인 지식이 실제 규칙으로 변환됨
- ✅ AI에서 실행 가능한 형태로 준비됨
- ✅ 신뢰도 계산 방법이 정의됨
- ✅ 규칙 실행 순서가 정해짐

**🎯 2단계 완료! 이제 3단계로 진행할 준비가 되었습니다.**
