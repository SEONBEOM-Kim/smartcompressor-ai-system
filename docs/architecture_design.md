# Signalcraft 통합 아키텍처 설계

## 🏗️ 전체 시스템 아키텍처

```
┌─────────────────────────────────────────────────────────────────┐
│                    통합 게이트웨이 (Single Entry Point)                    │
│                    http://localhost:3000/                        │
└─────────────────────┬───────────────────────────────────────────┘
                      │
        ┌─────────────┼─────────────┐
        │             │             │
   ┌────▼────┐   ┌────▼────┐   ┌────▼────┐
   │ 관리자   │   │ 점주용   │   │ 고객용   │
   │ 대시보드  │   │ 모바일   │   │ 웹앱    │
   │         │   │ 앱      │   │         │
   └─────────┘   └─────────┘   └─────────┘
        │             │             │
        └─────────────┼─────────────┘
                      │
        ┌─────────────┼─────────────┐
        │             │             │
   ┌────▼────┐   ┌────▼────┐   ┌────▼────┐
   │ AI 진단  │   │ 라벨링   │   │ 알림     │
   │ 시스템   │   │ 시스템   │   │ 시스템   │
   └─────────┘   └─────────┘   └─────────┘
        │             │             │
        └─────────────┼─────────────┘
                      │
        ┌─────────────┼─────────────┐
        │             │             │
   ┌────▼────┐   ┌────▼────┐   ┌────▼────┐
   │ 데이터   │   │ 보안     │   │ 모니터링 │
   │ 분석     │   │ 시스템   │   │ 시스템   │
   └─────────┘   └─────────┘   └─────────┘
                      │
              ┌───────▼───────┐
              │ PostgreSQL    │
              │ 데이터베이스   │
              └───────────────┘
```

## 🎯 핵심 설계 원칙

### 1. **Single Entry Point (통합 게이트웨이)**
- **메인 URL**: `http://localhost:3000/`
- **역할**: 모든 시스템의 진입점
- **구성**: 기존 관리자 대시보드를 확장하여 통합 게이트웨이로 활용

### 2. **역할별 접근 제어**
```
관리자 (Admin)     → /admin/          → 전체 시스템 관리
점주 (Owner)       → /mobile_app/     → 매장 관리 및 모니터링  
라벨러 (Labeler)   → /static/human_labeling_interface.html → 라벨링 작업
고객 (Customer)    → /static/audio_recorder_client.html → AI 진단
```

### 3. **서비스 레이어 구조**
```
┌─────────────────────────────────────────┐
│              Presentation Layer         │
│  (HTML, CSS, JS - 정적 파일)            │
├─────────────────────────────────────────┤
│              API Gateway                │
│  (Express.js 라우터)                    │
├─────────────────────────────────────────┤
│              Service Layer              │
│  (비즈니스 로직)                        │
├─────────────────────────────────────────┤
│              Data Layer                 │
│  (PostgreSQL + 스마트 저장)             │
└─────────────────────────────────────────┘
```

## 🔧 기존 시스템 통합 방안

### **현재 상태**
- ✅ 관리자 대시보드: `/admin/`
- ✅ AI 진단 시스템: `/api/ai/*`
- ✅ 라벨링 시스템: `/static/human_labeling_interface.html`
- ✅ 모바일 앱: `/mobile_app/`
- ✅ 알림 시스템: `/api/notifications/*`
- ✅ 데이터 분석: `/api/analytics/*`
- ✅ 보안 시스템: `/security/*`

### **통합 방안**
1. **메인 페이지를 관리자 대시보드로 설정**
   - `http://localhost:3000/` → 관리자 대시보드
   - 기존 관리자 대시보드에 "시스템 개요" 섹션 추가

2. **관리자 대시보드에 시스템 카드 추가**
   - 각 시스템별 상태 및 빠른 접근 버튼
   - 실시간 시스템 상태 모니터링

3. **역할별 네비게이션**
   - 관리자: 전체 시스템 관리
   - 점주: 모바일 앱으로 리다이렉트
   - 라벨러: 라벨링 인터페이스로 리다이렉트

## 📱 사용자 플로우

### **관리자 플로우**
```
http://localhost:3000/ 
    ↓
관리자 대시보드 (통합 게이트웨이)
    ↓
┌─────────────────────────────────────┐
│  시스템 개요 카드들                  │
│  ┌─────────┐ ┌─────────┐ ┌─────────┐│
│  │ AI 진단  │ │ 라벨링   │ │ 모바일   ││
│  │ 시스템   │ │ 시스템   │ │ 앱      ││
│  └─────────┘ └─────────┘ └─────────┘│
│  ┌─────────┐ ┌─────────┐ ┌─────────┐│
│  │ 알림     │ │ 데이터   │ │ 보안     ││
│  │ 시스템   │ │ 분석     │ │ 시스템   ││
│  └─────────┘ └─────────┘ └─────────┘│
└─────────────────────────────────────┘
    ↓
각 시스템별 상세 관리
```

### **점주 플로우**
```
http://localhost:3000/mobile_app/
    ↓
점주용 모바일 앱 (PWA)
    ↓
실시간 매장 모니터링
```

### **라벨러 플로우**
```
http://localhost:3000/static/human_labeling_interface.html
    ↓
라벨링 작업 인터페이스
    ↓
PostgreSQL에 라벨 저장
```

## 🗄️ 데이터베이스 통합

### **PostgreSQL 테이블 구조**
```sql
-- 핵심 테이블들
labels              -- 라벨링 데이터
experts             -- 전문가 정보
stores              -- 매장 정보
devices             -- 디바이스 정보
labeling_stats      -- 라벨링 통계
ai_analysis_results -- AI 분석 결과 (스마트 저장)
positive_summaries  -- 긍정적 요약
```

### **스마트 저장 전략**
- **주의/긴급만 저장**: AI가 문제로 판단한 데이터만
- **특징 데이터 압축**: 전체 오디오 대신 MFCC 등 특징만
- **긍정적 신호 요약**: 하루 1-2회 정상 상태 요약

## 🔐 보안 및 권한 관리

### **역할 기반 접근 제어 (RBAC)**
```
Admin (관리자)
├── 전체 시스템 접근
├── 사용자 관리
├── 매장 관리
└── 시스템 설정

Owner (점주)
├── 자신의 매장만 접근
├── 실시간 모니터링
└── 알림 설정

Labeler (라벨러)
├── 라벨링 작업만
├── 자신의 작업 이력
└── 품질 피드백

Customer (고객)
├── AI 진단만
└── 결과 확인
```

## 🚀 배포 및 확장성

### **현재 구조 (로컬 개발)**
```
Node.js Express Server (Port 3000)
├── 정적 파일 서빙
├── API 엔드포인트
├── WebSocket 연결
└── PostgreSQL 연결
```

### **프로덕션 확장 계획**
```
Load Balancer
├── Node.js App Server 1
├── Node.js App Server 2
└── Node.js App Server N
    ↓
PostgreSQL Cluster
├── Master DB
└── Read Replicas
```

## ❓ 컨펌 질문

1. **메인 페이지를 관리자 대시보드로 설정**하는 것이 맞나요?
2. **기존 관리자 대시보드에 시스템 개요 카드**를 추가하는 방향이 맞나요?
3. **역할별 접근 제어** 구조가 적절한가요?
4. **데이터베이스 통합** 방안이 합리적인가요?

이 설계로 진행해도 될까요? 수정하고 싶은 부분이 있으면 말씀해 주세요!
