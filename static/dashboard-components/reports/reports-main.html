<style>
    .section-container {
        background-color: var(--card-bg, #22252A);
        border: 1px solid var(--border-color, #32363C);
        border-radius: 0.5rem;
        padding: 1.5rem;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        transition: all 0.3s ease;
    }
    
    .section-header {
        display: flex;
        align-items: center;
        margin-bottom: 1.5rem;
        padding-bottom: 0.75rem;
        border-bottom: 1px solid var(--border-color, #32363C);
    }
    
    .section-header h2, .section-header h3 {
        margin: 0;
        color: var(--text-primary, #FFFFFF);
        display: flex;
        align-items: center;
    }
    
    .section-header h2 {
        font-size: 1.5rem;
    }
    
    .section-header h3 {
        font-size: 1.1rem;
    }
    
    .section-header h2 i, .section-header h3 i {
        margin-right: 0.75rem;
        color: var(--accent-primary, #8A5CFE);
    }
    
    .reports-main-container {
        display: flex;
        flex-direction: column;
        gap: 2rem;
    }
    
    .generator-cards-container {
        display: flex;
        gap: 1.5rem;
        margin-bottom: 1.5rem;
    }
    
    .generator-cards-container > .card {
        flex: 1;
    }
    
    .reports-dashboard-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 1.5rem;
        margin-top: 1.5rem;
    }
    
    .report-card {
        background: var(--card-bg, #22252A);
        border: 1px solid var(--border-color, #32363C);
        border-radius: 0.5rem;
        padding: 1.5rem;
        text-align: center;
        transition: all 0.3s ease;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }
    
    .report-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 15px rgba(0, 0, 0, 0.2);
    }
    
    .report-card h3 {
        font-size: 1.2rem;
        color: var(--text-primary, #FFFFFF);
        margin-top: 0;
        margin-bottom: 1rem;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    
    .report-card h3 i {
        margin-right: 0.5rem;
        color: var(--accent-primary, #8A5CFE);
    }
    
    .report-card p {
        color: var(--text-secondary, #A0AEC0);
        margin: 0.5rem 0;
    }
    
    .health-score {
        font-size: 1.8rem;
        font-weight: bold;
        margin: 0.5rem 0;
    }
    
    .score-good { color: var(--success, #48BB78); }
    .score-avg { color: var(--warning, #ED8936); }
    .score-bad { color: var(--danger, #E53E3E); }
    
    .report-card .top-list {
        list-style: none;
        padding: 0;
        margin: 1rem 0 0;
        text-align: left;
    }
    
    .report-card .top-list li {
        padding: 0.25rem 0;
        color: var(--text-primary, #FFFFFF);
        display: flex;
        justify-content: space-between;
    }
    
    .report-card .top-list li span {
        color: var(--text-secondary, #A0AEC0);
    }
    
    .report-card .top-list li strong {
        color: var(--accent-primary, #8A5CFE);
    }
    
    /* New styles for improved report generator */
    .report-builder-container {
        background: var(--card-bg, #22252A);
        border: 1px solid var(--border-color, #32363C);
        border-radius: 0.5rem;
        padding: 1.5rem;
        margin-bottom: 1.5rem;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }
    
    .report-builder-header {
        display: flex;
        align-items: center;
        margin-bottom: 1.5rem;
    }
    
    .builder-steps {
        display: flex;
        justify-content: space-between;
        margin-bottom: 2rem;
        position: relative;
    }
    
    .builder-steps::before {
        content: '';
        position: absolute;
        top: 50%;
        left: 0;
        right: 0;
        height: 2px;
        background: var(--border-color, #32363C);
        z-index: 1;
    }
    
    .step {
        display: flex;
        flex-direction: column;
        align-items: center;
        position: relative;
        z-index: 2;
        text-align: center;
        width: 15%;
    }
    
    .step-number {
        width: 32px;
        height: 32px;
        border-radius: 50%;
        background: var(--secondary-bg, #22252A);
        border: 2px solid var(--border-color, #32363C);
        display: flex;
        align-items: center;
        justify-content: center;
        color: var(--text-secondary, #A0AEC0);
        font-weight: bold;
        margin-bottom: 0.5rem;
    }
    
    .step.active .step-number {
        background: var(--accent-primary, #8A5CFE);
        color: white;
        border-color: var(--accent-primary, #8A5CFE);
    }
    
    .step.completed .step-number {
        background: var(--success, #48BB78);
        color: white;
        border-color: var(--success, #48BB78);
    }
    
    .step-label {
        font-size: 0.85rem;
        color: var(--text-secondary, #A0AEC0);
    }
    
    .step.active .step-label {
        color: var(--accent-primary, #8A5CFE);
    }
    
    .step.completed .step-label {
        color: var(--success, #48BB78);
    }
    
    .builder-content {
        display: flex;
        gap: 1.5rem;
        margin-bottom: 1.5rem;
    }
    
    .builder-section {
        flex: 1;
        background: var(--secondary-bg, #22252A);
        border-radius: 0.5rem;
        padding: 1.25rem;
    }
    
    .control-group {
        margin-bottom: 1.25rem;
    }
    
    .control-group label {
        display: block;
        margin-bottom: 0.5rem;
        font-weight: 500;
        color: var(--text-primary, #FFFFFF);
    }
    
    .control-group select,
    .control-group input {
        width: 100%;
        padding: 0.5rem 0.75rem;
        border: 1px solid var(--border-color, #32363C);
        border-radius: 0.375rem;
        background-color: var(--primary-bg, #1A1C23);
        color: var(--text-primary, #FFFFFF);
    }
    
    .control-group .checkbox-group {
        display: flex;
        flex-direction: column;
        gap: 0.75rem;
    }
    
    .checkbox-item {
        display: flex;
        align-items: center;
    }
    
    .checkbox-item input[type="checkbox"] {
        width: 1.25rem;
        height: 1.25rem;
        margin-right: 0.75rem;
        cursor: pointer;
    }
    
    .checkbox-item label {
        margin: 0;
        cursor: pointer;
        color: var(--text-primary, #FFFFFF);
    }
    
    .info-icon {
        margin-left: 0.5rem;
        color: var(--text-secondary, #A0AEC0);
        cursor: help;
    }
    
    .preview-section {
        background: var(--secondary-bg, #22252A);
        border: 1px dashed var(--border-color, #32363C);
        border-radius: 0.5rem;
        padding: 1.25rem;
        min-height: 200px;
        display: flex;
        align-items: center;
        justify-content: center;
        text-align: center;
        color: var(--text-secondary, #A0AEC0);
    }
    
    .action-buttons {
        display: flex;
        justify-content: center;
        gap: 1rem;
        margin-top: 1rem;
    }
    
    .btn {
        padding: 0.5rem 1rem;
        border-radius: 0.375rem;
        border: none;
        font-size: 0.9rem;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.3s ease;
        text-align: center;
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
    }
    
    .btn-primary {
        background-color: var(--accent-primary, #8A5CFE);
        color: white;
    }
    
    .btn-primary:hover {
        opacity: 0.9;
    }
    
    .btn-secondary {
        background-color: var(--text-secondary, #A0AEC0);
        color: var(--primary-bg, #1A1C23);
    }
    
    .btn-secondary:hover {
        opacity: 0.9;
    }
    
    .btn-outline {
        background-color: transparent;
        color: var(--accent-primary, #8A5CFE);
        border: 1px solid var(--accent-primary, #8A5CFE);
    }
    
    .btn-outline:hover {
        background-color: var(--accent-primary, #8A5CFE);
        color: white;
    }
    
    .report-title {
        font-size: 1.25rem;
        margin-bottom: 0.5rem;
        color: var(--text-primary, #FFFFFF);
    }
    
    .report-config {
        font-size: 0.9rem;
        color: var(--text-secondary, #A0AEC0);
        margin-bottom: 0.5rem;
    }
    
    .report-metrics {
        display: flex;
        flex-wrap: wrap;
        gap: 0.5rem;
        margin-top: 1rem;
        justify-content: center;
    }
    
    .metric-badge {
        background: rgba(138, 92, 254, 0.15);
        color: var(--accent-primary, #8A5CFE);
        padding: 0.25rem 0.5rem;
        border-radius: 0.25rem;
        font-size: 0.8rem;
    }
    
    .quick-preset {
        display: flex;
        flex-wrap: wrap;
        gap: 0.5rem;
        margin-bottom: 1rem;
        justify-content: center;
    }
    
    .preset-btn {
        background: var(--primary-bg, #1A1C23);
        color: var(--text-secondary, #A0AEC0);
        border: 1px solid var(--border-color, #32363C);
        border-radius: 0.375rem;
        padding: 0.25rem 0.5rem;
        font-size: 0.8rem;
        cursor: pointer;
    }
    
    .preset-btn.active {
        background: var(--accent-primary, #8A5CFE);
        color: white;
        border-color: var(--accent-primary, #8A5CFE);
    }
    
    /* Responsive design */
    @media (max-width: 768px) {
        .builder-content {
            flex-direction: column;
        }
        
        .builder-steps {
            flex-wrap: wrap;
            gap: 1rem;
        }
        
        .builder-steps::before {
            display: none;
        }
        
        .step {
            width: auto;
            margin-bottom: 1rem;
        }
        
        .action-buttons {
            flex-direction: column;
        }
    }
</style>

<div class="section-container reports-main-container">
    <h2 style="display: none;"></h2>
    
    <!-- 1. 개선된 맞춤형 보고서 생성기 -->
    <div class="report-builder-container">
        <div class="report-builder-header">
            <h2><i class="fas fa-tools" style="color: var(--accent-primary, #8A5CFE);"></i> 맞춤형 보고서 생성기</h2>
        </div>
        
        <div class="builder-steps">
            <div class="step active">
                <div class="step-number">1</div>
                <div class="step-label">필터 설정</div>
            </div>
            <div class="step">
                <div class="step-number">2</div>
                <div class="step-label">지표 선택</div>
            </div>
            <div class="step">
                <div class="step-number">3</div>
                <div class="step-label">보고서 미리보기</div>
            </div>
            <div class="step">
                <div class="step-number">4</div>
                <div class="step-label">생성/내보내기</div>
            </div>
        </div>
        
        <div class="builder-content">
            <div class="builder-section">
                <div class="section-header">
                    <h3><i class="fas fa-filter" style="color: var(--accent-primary, #8A5CFE);"></i> 필터 설정</h3>
                </div>
                
                <div class="quick-preset">
                    <button class="preset-btn active">이상 징후 분석</button>
                    <button class="preset-btn">자산 건전성</button>
                    <button class="preset-btn">유지보수 이력</button>
                    <button class="preset-btn">성능 지표</button>
                </div>
                
                <div class="control-group">
                    <label for="date-range">기간 선택 
                        <i class="fas fa-info-circle info-icon" title="보고서에 포함할 데이터의 기간을 선택하세요"></i>
                    </label>
                    <select id="date-range">
                        <option>지난 7일</option>
                        <option selected>지난 30일</option>
                        <option>이번 분기</option>
                        <option>사용자 지정</option>
                    </select>
                </div>
                
                <div class="control-group">
                    <label for="asset-group">자산 그룹 
                        <i class="fas fa-info-circle info-icon" title="보고서에 포함할 자산 그룹을 선택하세요"></i>
                    </label>
                    <select id="asset-group">
                        <option>모든 자산</option>
                        <option>A라인</option>
                        <option>B라인</option>
                        <option>서울 데이터센터</option>
                        <option>부산 데이터센터</option>
                    </select>
                </div>
                
                <div class="control-group">
                    <label for="granularity">집계 단위 
                        <i class="fas fa-info-circle info-icon" title="데이터를 집계할 시간 단위를 선택하세요"></i>
                    </label>
                    <select id="granularity">
                        <option>시간별</option>
                        <option selected>일별</option>
                        <option>주별</option>
                        <option>월별</option>
                    </select>
                </div>
            </div>
            
            <div class="builder-section">
                <div class="section-header">
                    <h3><i class="fas fa-chart-bar" style="color: var(--accent-primary, #8A5CFE);"></i> 지표 선택</h3>
                </div>
                
                <div class="control-group">
                    <div class="checkbox-group">
                        <div class="checkbox-item">
                            <input type="checkbox" id="metric1" checked> 
                            <label for="metric1">평균 소음(dB)</label>
                            <i class="fas fa-info-circle info-icon" title="자산의 평균 소음 레벨을 보고합니다"></i>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="metric2" checked> 
                            <label for="metric2">최고 온도(°C)</label>
                            <i class="fas fa-info-circle info-icon" title="자산의 최고 온도를 보고합니다"></i>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="metric3" checked> 
                            <label for="metric3">가동 시간</label>
                            <i class="fas fa-info-circle info-icon" title="자산의 총 가동 시간을 보고합니다"></i>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="metric4" checked> 
                            <label for="metric4">이상 징후 횟수</label>
                            <i class="fas fa-info-circle info-icon" title="감지된 이상 징후 발생 횟수를 보고합니다"></i>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="metric5"> 
                            <label for="metric5">유지보수 이력</label>
                            <i class="fas fa-info-circle info-icon" title="자산의 유지보수 이력을 보고합니다"></i>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="metric6"> 
                            <label for="metric6">전력 소비</label>
                            <i class="fas fa-info-circle info-icon" title="자산의 전력 소비량을 보고합니다"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="section-header">
            <h3><i class="fas fa-eye" style="color: var(--accent-primary, #8A5CFE);"></i> 보고서 미리보기</h3>
        </div>
        
        <div class="preview-section">
            <div>
                <div class="report-title">자산 상태 분석 보고서</div>
                <div class="report-config">기간: 지난 30일 | 자산 그룹: 모든 자산 | 집계 단위: 일별</div>
                <div class="report-metrics">
                    <span class="metric-badge">평균 소음(dB)</span>
                    <span class="metric-badge">최고 온도(°C)</span>
                    <span class="metric-badge">가동 시간</span>
                    <span class="metric-badge">이상 징후 횟수</span>
                </div>
                <p style="margin-top: 1rem;">선택한 설정에 따라 보고서가 생성됩니다</p>
            </div>
        </div>
        
        <div class="action-buttons">
            <button class="btn btn-primary generate-btn">
                <i class="fas fa-play"></i> 보고서 생성
            </button>
            <button class="btn btn-outline save-preset-btn">
                <i class="fas fa-save"></i> 템플릿으로 저장
            </button>
            <button class="btn btn-secondary export-pdf-btn">
                <i class="fas fa-file-pdf"></i> PDF로 내보내기
            </button>
            <button class="btn btn-secondary export-csv-btn">
                <i class="fas fa-file-csv"></i> CSV로 내보내기
            </button>
        </div>
    </div>

    <!-- 2. 정기 리포트 대시보드 -->
    <div class="section-spacing">
        <div class="section-header">
            <h2><i class="fas fa-tachometer-alt" style="color: var(--accent-primary, #8A5CFE);"></i> 정기 리포트 대시보드 (월간)</h2>
        </div>
        <div class="reports-dashboard-grid">
            <div class="report-card">
                <h3><i class="fas fa-heartbeat" style="color: var(--success, #48BB78);"></i> 자산 건전성 리포트</h3>
                <p>전체 자산 평균</p>
                <div class="health-score score-good">88점</div>
                <p style="font-weight: bold;">건강 점수 하락 Top 3</p>
                <ul class="top-list">
                    <li><span>압축기 #5</span> <strong>-15점</strong></li>
                    <li><span>냉동고-B2</span> <strong>-8점</strong></li>
                    <li><span>압축기 #2</span> <strong>-5점</strong></li>
                </ul>
            </div>
            <div class="report-card">
                <h3><i class="fas fa-fire" style="color: var(--warning, #ED8936);"></i> 이상 징후 핫스팟</h3>
                <p style="font-weight: bold;">최다 발생 자산 Top 3</p>
                 <ul class="top-list">
                    <li><span>압축기 #3</span> <strong>12 건</strong></li>
                    <li><span>냉동고-A1</span> <strong>8 건</strong></li>
                    <li><span>압축기 #5</span> <strong>7 건</strong></li>
                </ul>
                <canvas id="anomalyTypeChart"></canvas>
            </div>
             <div class="report-card">
                <h3><i class="fas fa-tools" style="color: var(--accent-secondary, #38B2AC);"></i> 유지보수 효과 분석</h3>
                <p style="font-weight: bold;">평균 조치 소요 시간 (MTTR)</p>
                <div class="health-score score-avg">6.5 시간</div>
                <p style="font-weight: bold;">유지보수 후 징후 감소율</p>
                <div class="health-score score-good">+ 75%</div>
            </div>
        </div>
    </div>
</div>

<script>
    // Add interactivity to the report builder
    document.addEventListener('DOMContentLoaded', function() {
        // Toggle active state for steps
        const steps = document.querySelectorAll('.step');
        steps.forEach(step => {
            step.addEventListener('click', function() {
                steps.forEach(s => s.classList.remove('active', 'completed'));
                
                const currentIndex = Array.from(steps).indexOf(this);
                for (let i = 0; i <= currentIndex; i++) {
                    if (i < currentIndex) {
                        steps[i].classList.add('completed');
                    } else {
                        steps[i].classList.add('active');
                    }
                }
            });
        });
        
        // Toggle preset buttons
        const presetBtns = document.querySelectorAll('.preset-btn');
        presetBtns.forEach(btn => {
            btn.addEventListener('click', function() {
                presetBtns.forEach(b => b.classList.remove('active'));
                this.classList.add('active');
                
                // Update report preview based on preset
                const reportTitle = document.querySelector('.report-title');
                const reportConfig = document.querySelector('.report-config');
                
                switch(this.textContent) {
                    case '이상 징후 분석':
                        reportTitle.textContent = '이상 징후 분석 보고서';
                        reportConfig.textContent = '기간: 지난 30일 | 자산 그룹: 모든 자산 | 집계 단위: 일별';
                        break;
                    case '자산 건전성':
                        reportTitle.textContent = '자산 건전성 분석 보고서';
                        reportConfig.textContent = '기간: 지난 30일 | 자산 그룹: 모든 자산 | 집계 단위: 일별';
                        break;
                    case '유지보수 이력':
                        reportTitle.textContent = '유지보수 이력 분석 보고서';
                        reportConfig.textContent = '기간: 지난 30일 | 자산 그룹: 모든 자산 | 집계 단위: 일별';
                        break;
                    case '성능 지표':
                        reportTitle.textContent = '성능 지표 분석 보고서';
                        reportConfig.textContent = '기간: 지난 30일 | 자산 그룹: 모든 자산 | 집계 단위: 일별';
                        break;
                }
            });
        });
        
        // Update report preview when filters or metrics change
        const filterElements = document.querySelectorAll('#date-range, #asset-group, #granularity');
        const metricElements = document.querySelectorAll('.checkbox-group input[type="checkbox"]');
        
        filterElements.forEach(element => {
            element.addEventListener('change', updatePreview);
        });
        
        metricElements.forEach(element => {
            element.addEventListener('change', updatePreview);
        });
        
        function updatePreview() {
            // Get selected values
            const dateRange = document.getElementById('date-range').value;
            const assetGroup = document.getElementById('asset-group').value;
            const granularity = document.getElementById('granularity').value;
            
            // Update report config text
            const reportConfig = document.querySelector('.report-config');
            reportConfig.textContent = `기간: ${dateRange} | 자산 그룹: ${assetGroup} | 집계 단위: ${granularity}`;
            
            // Update selected metrics
            const selectedMetrics = [];
            metricElements.forEach(element => {
                if (element.checked) {
                    const label = element.nextElementSibling.textContent;
                    selectedMetrics.push(label);
                }
            });
            
            // Update metrics display
            const metricsContainer = document.querySelector('.report-metrics');
            metricsContainer.innerHTML = '';
            
            selectedMetrics.forEach(metric => {
                const span = document.createElement('span');
                span.className = 'metric-badge';
                span.textContent = metric;
                metricsContainer.appendChild(span);
            });
        }
        
        // Add tooltips to info icons
        const infoIcons = document.querySelectorAll('.info-icon');
        infoIcons.forEach(icon => {
            icon.addEventListener('mouseenter', function() {
                // In a real implementation, you would show a tooltip here
                // For now, just log the title
                console.log(this.title);
            });
        });
    });
</script>